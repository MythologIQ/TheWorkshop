{
  "sequence": "007",
  "id": "WS-CODEX-007",
  "phase": "Scaffolding Bridge: Data Model Integration",
  "title": "Implement Project Persistence Layer and Local Storage Adapter",
  "summary": "Replace placeholder projectStore with a full domain model, storage adapter, autosave, and alignment to Workshop ATLAS terminology.",
  "instructions": "You must follow the WORKSHOP_ATLAS.MD terminology and the SAFETY_CONTRACT.md rules.\n\nGoal for this task:\nImplement a real domain shape and persistence layer so that projects, steps, reflections, and tests survive reloads and can be safely extended by later stations.\n\nPerform these steps:\n\n1) Create domain folder and types\n   - Create a folder: app/src/domain/\n   - Add TypeScript models:\n     - project.ts\n     - step.ts\n     - reflection.ts\n     - test.ts\n     - archive.ts\n   - Define interfaces for:\n     - Project\n     - Goal\n     - Step\n     - Reflection\n     - TestResult\n     - ArchiveEntry\n   - Keep these types small and focused, with comments that reference the Workshop ATLAS concepts (Idea Station, Build Station, etc).\n\n2) Implement ID helper\n   - Add a small helper (for example in app/src/domain/id.ts) that wraps nanoid or a similar tiny ID generator.\n   - Use this helper for all new Project, Step, Reflection, TestResult, and ArchiveEntry IDs.\n\n3) Implement local storage adapter\n   - Create app/src/runtime/storage/local_storage_adapter.ts.\n   - Implement functions:\n     - saveProject(project: Project): Promise<void>\n     - loadProject(id: string): Promise<Project | null>\n     - listProjects(): Promise<Project[]>\n     - deleteProject(id: string): Promise<void>\n   - Use window.localStorage under a single key namespace like \"workshop.projects\".\n   - Handle missing or malformed data defensively: never throw, always repair or return safe defaults.\n\n4) Wire projectStore to the adapter\n   - Update or create projectStore so it no longer holds a purely in-memory map.\n   - On initialization, call listProjects() to populate state.\n   - When creating, updating, or deleting projects, always call the adapter.\n   - Ensure that the active project ID is saved (for example under \"workshop.activeProjectId\") so it can be restored on reload.\n\n5) Autosave behavior\n   - Ensure that whenever a Step, Reflection, or TestResult is updated, the owning Project is saved.\n   - Keep autosave behavior simple and predictable; you may debounce writes lightly, but do not use complex queues for v1.\n\nRespect the Creativity Boundary spec:\n   - Before saving, clamp text lengths and counts to the limits described there.\n   - Document truncation behavior with comments so it is easy to reason about later.\n\nDo not design station UIs in this task. Focus only on domain types, the adapter, and projectStore wiring.",
  "acceptance_criteria": [
    "app/src/domain/ defines Project, Goal, Step, Reflection, TestResult, and ArchiveEntry types aligned with Workshop ATLAS terminology.",
    "An ID helper exists and is used for new entities.",
    "local_storage_adapter.ts implements saveProject, loadProject, listProjects, and deleteProject using localStorage safely.",
    "projectStore initialization and mutation paths now depend on the adapter rather than in-memory-only state.",
    "Active project ID is persisted and restored, and autosave persists edits to steps, reflections, and tests."
  ]
}